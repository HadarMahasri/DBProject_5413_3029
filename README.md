# פרויקט בסיסי נתונים

הדר מהסרי 213953029 הודיה גומה 329385413

יחידה נבחרת: operations branch

## תוכן עניינים

- [שלב א: עיצוב ויצירת מסד נתונים](#שלב-א-עיצוב-ויצירת-מסד-נתונים)  
  - [מבוא](#מבוא)
  - [תיאור המערכת](#תיאור-המערכת)
  - [תרשימי מערכת](#תרשימי-מערכת)  
  - [החלטות עיצוב](#החלטות-עיצוב)
  - [מבנה הטבלאות](#מבנה-הטבלאות)
  - [הכנסת נתונים](#הכנסת-נתונים)
  - [גיבוי](#גיבוי)  
- [שלב ב: שאילתות](#שלב-ב-שאילתות)
  - [שאילתות בחירה](#שאילתות-בחירה)
  - [שאילתות עדכון](#שאילתות-עדכון)
  - [שאילתות מחיקה](#שאילתות-מחיקה)
  - [אילוצים](#אילוצים)
- [שלב ג: אינטגרציה ומבטים](#שלב-ג-אינטגרציה-ומבטים)
  - [מבטים](#מבטים)
- [שלב ד: תכנות](#שלב-ד-תכנות)
  - [פונקציות](#פונקציות)
  - [פרוצדורות](#פרוצדורות)
  - [טריגרים](#טריגרים)
  - [תוכניות](#תוכניות)
## שלב א: עיצוב ויצירת מסד נתונים 
 ### מבוא
מסמך זה מתאר את שלב א' בפרויקט מערכת ניהול מבצעים צבאית. המערכת מיועדת לניהול מידע על מבצעים צבאיים, יחידות המשתתפות בהם, המפקדים האחראים, הציוד הנדרש, המשימות הספציפיות והדוחות המבצעיים.

 ### תיאור המערכת
המערכת מיועדת לניהול ומעקב אחר מבצעים צבאיים על כל מרכיביהם. היא מאפשרת:

- תיעוד מבצעים צבאיים כולל מטרות, מיקומים ותאריכים
- ניהול יחידות צבאיות והשיוך שלהן לחילות השונים
- ניהול מפקדים, דרגותיהם וניסיונם
- מעקב אחר ציוד המשמש במבצעים
- ניהול משימות ספציפיות במסגרת כל מבצע
- תיעוד דוחות מבצעיים

המערכת מספקת את הפונקציונליות העיקרית הבאה:

הקצאת יחידות למבצעים
הקצאת ציוד למבצעים
תזמון משימות במסגרת מבצעים
מעקב אחר דוחות והתקדמות המבצעים
ניהול היררכיית הפיקוד והאחריות


 ### תרשימי מערכת

  : ERD  דיאגרמת יחסי ישויות 


דיאגרמת ה-ERD מתארת את הישויות במערכת ואת היחסים ביניהן:
![image](https://github.com/user-attachments/assets/8cab3a83-2fa3-454d-9e5f-2ebece072fda)


הישויות העיקריות במערכת:

מבצע (Operation) - הישות המרכזית המתארת מבצע צבאי
מפקד (Commander) - מפקדים האחראים על מבצעים
חיל (Corps) - החילות השונים בצבא
יחידה (Unit) - יחידות צבאיות המשתייכות לחילות
ציוד (Equipment) - ציוד צבאי המשמש במבצעים
משימה (Task) - משימות ספציפיות במסגרת מבצעים
דו"ח מבצעי (Operational Report) - דוחות על מבצעים

היחסים בין הישויות:

מוביל (Leads) - מפקד מוביל מבצע (יחס 1)
בוצע על ידי (Executed by) - מבצע מבוצע על ידי יחידות (יחס N)
מתזמן (Schedules) - מבצע כולל משימות (יחס 1)
דורש (Requires) - מבצע דורש ציוד (יחס N)
שייך ל (Belongs to) - יחידה שייכת לחיל (יחס N:1)
מתעד (Documents) - דוח מתעד מבצע (יחס N:1)

DSD - דיאגרמת סכמת נתונים
דיאגרמת ה-DSD מציגה את הטבלאות במסד הנתונים והקשרים ביניהן:
![alt text](<שלב א/image-1.png>)
### החלטות עיצוב
במהלך תכנון המערכת התקבלו מספר החלטות עיצוב:

- שימוש במספרים רצים (SERIAL) - בחרנו להשתמש במספרים רצים עבור המפתחות הראשיים בכל הטבלאות כדי לפשט את תהליך ההוספה של נתונים חדשים ולמנוע שגיאות.
- הפרדה בין חיל ליחידה - החלטנו להפריד את החילות והיחידות לטבלאות נפרדות כדי לשקף את המבנה ההיררכי הצבאי ולאפשר שיוך של יחידות לחילות.
- ניהול קשרים רבים-לרבים (N) - עבור הקשרים בין מבצעים ליחידות ובין מבצעים לציוד, יצרנו טבלאות קשר מפורשות (Executed_by ו-Requires) כדי לנהל את הקשרים הרבים-לרבים.
- תיעוד זמנים של משימות - בחרנו לכלול שדות StartTime ו-EndTime בטבלת Task כדי לאפשר תזמון מדויק של משימות במסגרת המבצעים.

### מבנה הטבלאות 
להלן מבנה הטבלאות שיצרנו במסד הנתונים:

![image-2](https://github.com/user-attachments/assets/fe385601-e63d-48b5-981b-f02944021fc4)
![image-3](https://github.com/user-attachments/assets/f0c3bc29-711e-4117-9653-5f73d3c3c3f6)
![image-4](https://github.com/user-attachments/assets/c88535bb-9bac-40e4-8c4c-3f176b95dd2a)
![alt text](<שלב א/image-5.png>)


### הכנסת נתונים
שיטה 1 - Mockaroo
עבור טבלת commander:

![alt text](image-5.png)
![alt text](<שלב א/image-6.png>)
עבור טבלת corps:
![alt text](<שלב א/image-7.png>)
![alt text](<שלב א/image-8.png>)

עבור טבלת operation:
![alt text](<שלב א/image-9.png>)
![alt text](<שלב א/image-10.png>)



שיטה 2- הכנסת נתונים מקבצי אקסל
עבור טבלת Equipment:






![alt text](<שלב א/image-11.png>)





עבור טבלת OperationalReport:





![alt text](<שלב א/image-12.png>)





עבור טבלת Unit:







![alt text](<שלב א/image-13.png>)



שיטה 3- הכנסת נתונים דרך פייתון
עבור טבלת Executed_by:
![alt text](<שלב א/image-14.png>)
![alt text](<שלב א/image-15.png>)

עבור טבלת Task:
![alt text](<שלב א/image-16.png>)
![alt text](<שלב א/image-17.png>)

עבור טבלת Requires:
![alt text](<שלב א/image-18.png>)
![alt text](<שלב א/image-19.png>)


### גיבוי

ביצוע גיבוי: 

![alt text](<שלב א/image-20.png>)

ביצוע שחזור:
יצרתי database חדש בשם backup על מנת לראות אם השחזור צלח.
ובהחלט 9 הטבלאות שוחזרו בהצלחה עם כל הנתונים. צירפתי דוגמא לטבלת unit בעלת 403 רשומות.

![alt text](<שלב א/image-21.png>)

![alt text](<שלב א/image-22.png>) 
# שלב ב: שאילתות

## שאילתות בחירה

**1.השאילתה מציגה את כל המבצעים (Operations) שדורשים יותר ציוד מהממוצע הכללי של ציוד למבצע.
לכל מבצע מוצגים מזהה המבצע, שמו, וכמות הציודים הנדרשים לו, בסדר יורד לפי כמות הציוד.**

![צילום מסך 2025-05-05 174139](https://github.com/user-attachments/assets/d3e8e9e1-2124-403a-8052-8b66ac5fcf5e)


![WhatsApp Image 2025-05-05 at 13 45 18](https://github.com/user-attachments/assets/fbf8aa5f-064f-47e1-a98b-c3e06ac773f3)  

**2.השאילתה מחזירה את כל המפקדים שיש להם יותר מ־10 שנות ניסיון, אך אינם מובילים כרגע אף מבצע פעיל (כלומר, מבצע שטרם הסתיים).
הרשימה ממויינת לפי שנות הניסיון מהגבוה לנמוך.**

![צילום מסך 2025-05-05 181901](https://github.com/user-attachments/assets/f265a645-3352-450a-a62b-7da7faeee92f)

![צילום מסך 2025-05-05 182003](https://github.com/user-attachments/assets/20e6d990-9404-4083-b310-124f9bc462f0)

**3. השאילתה מחפשת מבצעים (Operations) שיש להם יותר משימות (Tasks) מהממוצע הכללי של משימות למבצע.
לכל מבצע מוצגים מזהה, שם, וכמות המשימות, כשהתוצאה ממויינת בסדר יורד לפי מספר המשימות.**

![צילום מסך 2025-05-05 174851](https://github.com/user-attachments/assets/92a7b383-bcd2-4768-81ce-c049c0507f0c)
  ![צילום מסך 2025-05-05 175343](https://github.com/user-attachments/assets/676d664e-b696-4ac0-ad34-47b30a3568e4)

  
  
**4.השאילתה מציגה את כל היחידות (Units) בצבא, יחד עם חיל השייכות שלהן והתמחות החיל,
ומחשבת עבור כל יחידה את מספר המבצעים (Operations) שבהם השתתפה – ממויין מהכי פעילה לפחות.**

![צילום מסך 2025-05-05 175725](https://github.com/user-attachments/assets/8b511604-a15f-454e-835a-a3215200a799)

![צילום מסך 2025-05-05 175905](https://github.com/user-attachments/assets/dc367970-382d-4ac5-b86d-2c0937a3a79f)  

**5.השאילתא בוחרת את מזהה הפעולה, שם הפעולה, תאריך התחלה ותאריך סיום של פעולות, ומחלקת את זמן הפעולה לפי ימים (DurationDays). 
היא מחזירה רק פעולות שמשך הזמן שלהן מעל 500 ימים וממיינת את התוצאות בסדר יורד לפי משך הזמן.**

![צילום מסך 2025-05-05 182329](https://github.com/user-attachments/assets/b3239a7f-2cf7-49ab-8199-9e95c2aa604d)
![צילום מסך 2025-05-05 182412](https://github.com/user-attachments/assets/c7af01eb-aed8-43b5-8078-5c665e9f3e70)

**6.השאילתא בוחרת את מזהה הציוד, שם הציוד, כמות הציוד הזמינה, מספר הפעמים שהציוד שומש בפעולות, וסך הכמות שנדרשה בכל הפעולות.
היא מציגה ציוד ששומש ביותר מפעם אחת, וממיינת את התוצאות בסדר יורד לפי מספר השימושים.**

![צילום מסך 2025-05-05 182744](https://github.com/user-attachments/assets/8d4266c4-e527-440a-86e3-6688ed9714c6)

![צילום מסך 2025-05-05 182832](https://github.com/user-attachments/assets/8da221f6-6828-46f3-a4bf-1a8b12843049)


**7.השאילתא מציגה משימות שבוצעו במהלך חודש פברואר 2023, כולל מזהה המשימה, תיאורה, תאריך, שעת התחלה, שעת סיום ושם הפעולה שאליה היא שייכת.
התוצאות ממוינות לפי תאריך המשימה ושעת ההתחלה.**

![צילום מסך 2025-05-05 182929](https://github.com/user-attachments/assets/ad5b2c12-cbe4-4c5f-98c2-1cf429981ef1)
![צילום מסך 2025-05-05 183132](https://github.com/user-attachments/assets/3b838630-dd04-4bb6-aaa0-0f49baffbaa0)

**8.השאילתא מציגה את מספר הפעולות שהחלו בכל חודש בשנת 2023. היא מחלקת את התוצאות לפי חודש ומציינת את מספר הפעולות שהחלו בכל אחד מהם, כשהמיון נעשה לפי מספר החודש בסדר עולה.**

![צילום מסך 2025-05-05 183305](https://github.com/user-attachments/assets/896f86fc-6436-433d-9211-ffb2c5a587c1)

![צילום מסך 2025-05-05 183452](https://github.com/user-attachments/assets/47cdfe5b-086b-44e7-93e1-d6db04d2371d)

  ### שאילתות עדכון

 **1.השאילתא מעדכנת את דרגת המפקדים בטבלה Commander, כך שכל מפקד שיש לו יותר מ־20 שנות ניסיון ואינו בדרגת "General", יקודם לדרגה זו.**

![צילום מסך 2025-05-05 192158](https://github.com/user-attachments/assets/a8d0c093-701c-446e-97ef-963253bc6bd6)

![צילום מסך 2025-05-05 192333](https://github.com/user-attachments/assets/fed086d7-956a-4da0-b52e-3953083f2c62)

![צילום מסך 2025-05-05 192431](https://github.com/user-attachments/assets/4ff7fe35-9690-424d-9211-d5275ed52575)

**2.השאילתה מעדכנת את עמודת תאריך הסיום (endDate) של פעולות שהסתיימו בפברואר 2023.
לכל פעולה כזו מתווספים 3 ימים לתאריך הסיום.**

![צילום מסך 2025-05-05 192710](https://github.com/user-attachments/assets/27ec85cd-a794-4390-925a-abbf06763bc3)
![צילום מסך 2025-05-05 192900](https://github.com/user-attachments/assets/13f79385-a582-4037-9944-4c5762de8073)
![צילום מסך 2025-05-05 192943](https://github.com/user-attachments/assets/3574efa2-ff51-4a03-ab9b-ed24ef9be354)

**3. השאילתה מעדכנת את עמודת Specialization לחיל האוויר בערך "Tactical Navigation".
העדכון יתבצע רק אם השדה ריק או לא הוזן בו ערך קודם (NULL או מחרוזת ריקה).**

![צילום מסך 2025-05-05 201110](https://github.com/user-attachments/assets/7ddc35a0-5d01-496e-b280-64dfa2e68f5f)
![צילום מסך 2025-05-05 202809](https://github.com/user-attachments/assets/bb381ccf-f478-4bc8-aaef-32738fae4f92)
![צילום מסך 2025-05-05 203247](https://github.com/user-attachments/assets/6c0715d3-5a23-4883-bebf-e4d2e9b6ce4e)

  ### שאילתות מחיקה
**1.השאילתה מוחקת את כל המשימות מהטבלה Task שתאריך הביצוע שלהן לפני 1 בינואר 2023.
המטרה היא לנקות נתונים ישנים שאינם רלוונטיים עוד.**


![צילום מסך 2025-05-05 205737](https://github.com/user-attachments/assets/7534b47e-9e46-412d-a548-1bb855988c1c)

![צילום מסך 2025-05-05 205912](https://github.com/user-attachments/assets/ed2ea27a-199f-460f-8982-40ae3d5821a6)

![צילום מסך 2025-05-05 210124](https://github.com/user-attachments/assets/75be394f-c0ed-4353-9ea8-97d64c5e2c92)

**2.השאילתה מוחקת ציוד מהטבלה Equipment שאינו נדרש לאף משימה לפי הטבלה Requires.
כלומר, היא מסירה ציוד שאין לו שימוש נוכחי במערכת.**

![צילום מסך 2025-05-05 210755](https://github.com/user-attachments/assets/3ff01838-8897-4fa6-b598-7893b6c78064)

![צילום מסך 2025-05-05 211416](https://github.com/user-attachments/assets/464de77f-785d-46ae-962e-e4b1b7733b8e)

![צילום מסך 2025-05-05 222504](https://github.com/user-attachments/assets/5713f95e-a527-42a9-99f6-d32e549f9b5c)

**3.השאילתה מוחקת רשומות מטבלת Requires שבהן מזהה הפעולה (OperationID) קיים גם בטבלת Operation, והפעולה הסתיימה לפני יותר מחודש.
היא משתמשת ב-USING כדי לבצע מחיקה מותנית על בסיס התאמה בין שתי טבלאות.**

![צילום מסך 2025-05-05 222737](https://github.com/user-attachments/assets/ab2ad606-1523-4719-8405-f5d07c02c5a4)

![צילום מסך 2025-05-05 222950](https://github.com/user-attachments/assets/be40a72e-1434-423a-8430-9ddbe5fbe766)
![צילום מסך 2025-05-05 223110](https://github.com/user-attachments/assets/dbd15eb2-bfd2-4e70-aeea-c1b67344f8cd)
## rollback ו-commit
**commit:**
![צילום מסך 2025-05-06 131720](https://github.com/user-attachments/assets/116b850a-aac5-4d65-a624-ac66b5005db1)

![צילום מסך 2025-05-06 132334](https://github.com/user-attachments/assets/157db283-04cf-4eb7-b4cb-355fb7cd9713)
![צילום מסך 2025-05-06 132718](https://github.com/user-attachments/assets/72c70751-3aaf-4d1f-a4db-b98316e7218c)
**rollback:**
![צילום מסך 2025-05-06 132856](https://github.com/user-attachments/assets/cf152637-e642-443f-a989-c6531dd40b55)
![צילום מסך 2025-05-06 133037](https://github.com/user-attachments/assets/f21af9cb-fbd1-49be-b47e-d79b265a986a)

![צילום מסך 2025-05-06 133154](https://github.com/user-attachments/assets/ca181463-dab0-4109-961a-44721d84739a)

## אילוצים

###   Check אילוצי 

![alt text](<שלב ב/check1.png>)


![alt text](<שלב ב/check2.png>)


###   Not NULL אילוצי 

![alt text](<שלב ב/not null.png>)

###   Deafult אילוצי 

![alt text](<שלב ב/deafult1.png>)

# שלב ג: אינטגרציה ומבטים

-DSD של האגף החדש:

![alt text](<שלב ג/image-35.png>)

-ERD של האגף החדש:

 ![alt text](<שלב ג/image-34.png>)

-ERD של האינטגרציה: 

![alt text](<שלב ג/intergration-2.png>)

-DSD של האינטגרציה:

 ![alt text](<שלב ג/integrationDSD.png>)
 

## דוח שלב האינטגרציה - מערכת מידע רפואי וצבאית
  ### *החלטות שנעשו בשלב האינטגרציה*
**1. החלטה על מבנה הירושה**
החלטה: יצירת טבלת Soldier כטבלת אב משותפת לישויות Commander, Paramedic ו-Patient.
נימוק:

כל שלושת הסוגים הם בעצם חיילים עם תפקידים שונים
מאפשר ניהול מאוחד של מידע בסיסי (שם, מזהה)
יוצר היררכיה לוגית המשקפת את המציאות הצבאית


**2.  החלטה על טווחי מזהים נפרדים**

מפקדים: 1,000,000 + מזהה מקורי (טווח: 1,000,001 - 1,999,999)
פרמדיקים: 2,000,000 + מזהה מקורי (טווח: 2,000,001 - 2,999,999)
מטופלים: 3,000,000 + מזהה מקורי (טווח: 3,000,001 - 3,999,999)

נימוק:

מניעת התנגשויות בין מזהים מטבלאות שונות
זיהוי מיידי של סוג החייל לפי טווח המזהה
שמירה על פשטות המבנה ללא עמודות נוספות


**3. החלטה על שמות עמודות**
החלטה: שמירה על השמות המקוריים של העמודות (commander_id, paramedic_id, patient_id).
נימוק:

שמירה על תאימות עם קוד ומערכות קיימות
הבנה אינטואיטיבית של התפקיד לפי שם העמודה
הימנעות משינויים נרחבים בטבלאות הקשר

**4. החלטה על מיזוג טבלאות ציוד**
החלטה: שימוש במפתח מורכב (EquipmentID, equipment_type) במקום שינוי מזהים.
נימוק:

שמירה על המזהים המקוריים של הציוד
גמישות להוספת סוגי ציוד נוספים בעתיד
טבלה אחת לכל סוגי הציוד האפשריים (צבאי ורפואי)

**5. החלטה על קישור אירועים רפואיים למבצעים**
החלטה: קישור לפי תאריכים - אירוע רפואי שהתרחש בין תאריך התחלה וסיום של מבצע מקושר אליו.
נימוק:

קישור הגיוני המבוסס על זמן התרחשות
במבצע יכולים להתרחש מספר אירועים רפואיים



### הסבר מילולי של התהליך והפקודות

#### שלב 1: הכנה ליצירת הירושה

![alt text](<שלב ג/image-23.png>)



**הסבר: יצירת טבלת האב 
Soldier עם מבנה מינימלי - רק מזהה ושם. טבלה זו תשמש בסיס לכל סוגי החיילים.**

#### שלב 2: עדכון טבלת המפקדים

![alt text](<שלב ג/image-24.png>)

**הסבר: לפני שינוי מבנה הטבלה, חובה להסיר את כל האילוצים התלויים בה. קודם מסירים מפתחות זרים מטבלאות אחרות שמצביעות לטבלה, ואז את המפתח הראשי של הטבלה עצמה.**

![alt text](<שלב ג/image-26.png>)

**הסבר: הוספת המפקדים לטבלת האב עם המזהים החדשים (מקורי + מיליון), ואז עדכון המזהים בטבלת המפקדים עצמה להתאמה.**

![alt text](<שלב ג/image-27.png>)

**הסבר: עדכון כל הטבלאות שמפנות למפקדים כדי להתאים למזהים החדשים, ויצירת המפתחות מחדש לאחר השינויים.**



#### שלב 3: עדכון טבלת הפרמדיקים
התהליך זהה לשלב המפקדים, אך עם הוספת 2,000,000 למזהים:
![alt text](<שלב ג/image-28.png>)

#### שלב 4: עדכון טבלת המטופלים

![alt text](<שלב ג/image-29.png>)

#### שלב 5: מיזוג טבלאות ציוד

![alt text](<שלב ג/image-30.png>)

**הסבר: במקום לשנות מזהים, אנחנו יוצרים מפתח מורכב שמורכב ממזהה הציוד וסוגו. זה מאפשר לאותו מזהה להתקיים פעמיים - פעם אחת כציוד צבאי ופעם כציוד רפואי.**

**הסבר: העתקת הציוד הרפואי לטבלת הציוד המאוחדת עם שמירה על המזהים המקוריים וסימון הסוג כ-'Medical'.**

#### שלב 6: עדכון טבלאות הקשר לציוד

![alt text](<שלב ג/image-31.png>)

**הסבר: הוספת עמודת סוג ציוד לטבלאות הקשר ועדכון הערכים בהתאם. ציוד שמופיע בטבלת הציוד הרפואי מסומן כ-'Medical'.**

**הסבר: יצירת מפתח זר מורכב שמתאים למפתח הראשי המורכב של טבלת הציוד.**


#### שלב 7: קישור אירועים רפואיים למבצעים

![alt text](<שלב ג/image-32.png>)

**הסבר: הוספת עמודה לקישור אירועים רפואיים למבצעים, ועדכון אוטומטי של הקישורים לפי תאריכים. אירוע שהתרחש בזמן מבצע מקושר אליו.**


### מבטים

### View1
🏥 מבט 1: האגף הרפואי - Active_Paramedics
תכלית המבט
מבט המיועד לניהול הצוות הרפואי ומתמקד בביצועי הפרמדיקים והטיפולים שהם מעניקים.

טבלאות מעורבות:


Paramedic -
 מידע על הפרמדיקים (מזהה, שם, ניסיון)


Treatment - 
מידע על הטיפולים שניתנו (משך, סוג, תאריך)




![alt text](<שלב ג/image-39.png>)

![alt text](<שלב ג/image-36.png>)

שאילתא-1
-- שאילתה 1: מיהם הפרמדיקים הכי פעילים?
-- שאלה מעשית: איזה פרמדיקים נותנים הכי הרבה טיפולים?


![alt text](<שלב ג/image-40.png>)

![alt text](<שלב ג/image-41.png>)


שאילתא-2
-- שאילתה 2: איזה פרמדיקים צריכים עזרה או הכשרה?
-- שאלה מעשית: מי הפרמדיקים החדשים או הפחות פעילים שצריכים תמיכה?

![alt text](<שלב ג/image-42.png>)

![alt text](<שלב ג/image-43.png>)


### View2

 מבט 2: האגף הצבאי - Units_In_Operations
תכלית המבט
מבט המיועד לניהול הכוחות והמבצעים ומתמקד בהשתתפות יחידות במבצעים שונים.
טבלאות מעורבות:

Operation -
 מידע על המבצעים (שם, מיקום, תאריכים)

Executed_by -
טבלת קשר בין מבצעים ליחידות

Unit - 
מידע על היחידות (שם, כמות חיילים)

Corps -
 מידע על החילות (שם, התמחות)


![alt text](<שלב ג/image-45.png>)

![alt text](<שלב ג/image-44.png>)

שאילתא-1

-- שאילתה 1: איזה יחידות הכי פעילות?
-- שאלה פשוטה: אילו יחידות השתתפו בהכי הרבה מבצעים?

![alt text](<שלב ג/image-46.png>)

![alt text](<שלב ג/image-47.png>)

שאילתא-2

-- שאילתה 2: איזה חילות הכי נדרשים?
-- שאלה פשוטה: איזה סוגי חילות הכי הרבה פעמים נקראים למבצעים?

![alt text](<שלב ג/image-49.png>)

![alt text](<שלב ג/image-48.png>)






# שלב ד: תכנות pgSQL

## פונקציות

פונקציה 1- 

מטרה:
לספק מידע סטטיסטי על עומס רפואי לפי חיילות (corps) בכל מבצע (operation).

מה היא עושה בפועל:

סופרת את מספר הפצועים (patients) ששויכו לאירועים רפואיים (medical_event) שהתרחשו במהלך מבצעים מסוימים.

מקשרת בין 
corps → unit → executed_by → operation→medical_event → patient. 

מחלקת את מספר הפצועים לפי חיילת ומבצע.

מחשבת גם את אחוז הפצועים מתוך כלל הפצועים במערכת.

מסווגת את רמת העומס הרפואי כך:

מעל 10 פצועים → עומס חריג

מעל 5 פצועים → עומס בינוני

5 ומטה → עומס נמוך



![alt text](<שלב ד/get_corps_patient_summary_function().png>)

פונקציה 2-

פונקציה: get_logistic_status_by_operation()
מטרה:
להעריך את המצב הלוגיסטי של ציוד נדרש במבצעים לפי כמות הציוד בפועל מול הכמות שנדרשה.

מה היא עושה בפועל:

מקשרת בין מבצעים (operation), מפקדים (commander), דרישות ציוד (requires) וציוד קיים (equipment).

מחשבת את אחוז הכיסוי של ציוד מבוקש: כמות בפועל ÷ כמות נדרשת.

מגדירה סטטוס לוגיסטי לפי:

כיסוי של 100% → כיסוי תקין

כיסוי בין 70% ל־99% → כיסוי גבולי

כיסוי < 70% → מחסור בציוד

אין ציוד כלל → אין ציוד

![alt text](<שלב ד/get_logistic_status_by_operation_function.jpeg>)

## פרוצדרות
פרוצדורה 1-
מטרה:
לאתר מבצעים עם עומס רפואי חריג/בינוני וליצור עבורם דוחות אוטומטיים בטבלת operational_report.

מה היא עושה בפועל:

מפעילה את get_corps_patient_summary() ומשתמשת ב־cursor כדי לעבור על כל רשומה.

אם דרגת העומס של החיילת במבצע היא עומס בינוני או חריג – מתווסף דוח.

הדוח כולל: שם המבצע, החיילת, דרגת העומס.

תאריך הדוח נבחר באקראי בטווח שבין תאריך התחלה וסיום של המבצע.

יש שימוש ב־EXCEPTION כדי לטפל בשגיאות כמו הכנסת דוח כפול.



![alt text](<שלב ד/summarize_medical_load_to_report_procedure.png>)


פרוצדורה 2-

מטרה:
לזהות מבצעים עם בעיות לוגיסטיות ולתעד אותם בדוחות.

מה היא עושה בפועל:

קוראת לפונקציה get_logistic_status_by_operation().

עבור כל מבצע שיש בו מחסור בציוד או כיסוי גבולי, מתווסף דוח ל־operational_report.

כמו בתוכנית 1, תאריך הדוח נבחר באקראי בטווח התאריכים של המבצע.

אם מתרחשת שגיאה (למשל ניסיון להזין ID כפול), נרשמת הודעת שגיאה עם פרטי המבצע.


![alt text](<שלב ד/check_logistic_risk_operations_procedure.png>)

## טריגרים
טריגר 1-

פונקציית טריגר: trg_check_medical_load()

הגדרה: AFTER INSERT ON medical_event

מה היא עושה:
מפעילה אוטומטית את summarize_medical_load_to_report() בכל פעם שנוסף אירוע רפואי חדש.

למה זה חשוב?
זה מבטיח שמיד כשנוסף פצוע חדש – המערכת בודקת אם צריך להתריע על עומס רפואי.



![alt text](<שלב ד/trg_on_patient_insert.png>)

טריגר 2-

פונקציית טריגר: trg_check_logistic_risk()

הגדרה: AFTER INSERT OR UPDATE ON requires

מה היא עושה:
מפעילה את check_logistic_risk_operations() בכל שינוי בדרישות ציוד.

למה זה חשוב?
כי שינוי בדרישות יכול לגרום מידית לסיכון לוגיסטי שמחייב בדיקה ועדכון דוח.

![alt text](<שלב ד/טריגר check_logistic_risk.png>)

## תוכניות
תוכנית 1 – עומס רפואי במבצעים

מטרה:
לזהות האם יש עומס רפואי חריג או בינוני בחיילים שלקחו חלק במבצע מסוים, ולהפיק על כך דוח רשמי במערכת.

תיאור כללי:
התוכנית משתמשת בפונקציה שמסכמת את מספר הפצועים לכל חיל בכל מבצע, ומחשבת האם יש "עומס נמוך", "עומס בינוני" או "עומס חריג".
לאחר מכן, הפרוצדורה סורקת את התוצאות, ואם נמצא עומס בינוני או חריג – נרשם דוח חדש בטבלת operational_report עם התראה.

שלבים עיקריים:

הפונקציה get_corps_patient_summary() מחזירה את סך הפצועים לפי חיל ומבצע, כולל חישוב עומס.

לולאה עוברת על כל השורות ומדפיסה את המידע.

קריאה לפרוצדורה summarize_medical_load_to_report():

אם נמצא עומס בינוני או חריג – נכתב דוח רשמי עם תאריך אקראי בטווח של המבצע.

נבדק אם כבר קיים דוח דומה כדי להימנע מכפילויות.



![alt text](<שלב ד/image-51.png>)


![alt text](<שלב ד/הרצת תוכנית 1.png>)

לפני הרצה-

![alt text](<שלב ד/operation_report לפני עדכון.png>)


עדכון טבלת operation_report:

![alt text](<שלב ד/image-50.png>)





תוכנית 2 – התרעות לוגיסטיות

מטרה:
לבדוק האם קיים מחסור בציוד עבור מבצעים שונים, ולהגיב בהתאם באמצעות יצירת התראה (דוח לוגיסטי).

תיאור כללי:
התוכנית בודקת מה היחס בין ציוד נדרש לבין ציוד בפועל לכל מבצע, ומסווגת את רמת הכיסוי (כיסוי תקין / גבולי / מחסור).
במקרים של מחסור או כיסוי גבולי, נרשמת התראה בטבלת הדוחות.

שלבים עיקריים:

הפונקציה get_logistic_status_by_operation() מחזירה את הסטטוס הלוגיסטי לפי מבצע.

לולאה מציגה את מצב הכיסוי לכל מבצע.

קריאה לפרוצדורה check_logistic_risk_operations():

עבור כל מבצע עם מחסור או כיסוי גבולי, נוצרת רשומת דוח עם תאריך אקראי בטווח הפעילות של המבצע.

כולל טיפול בשגיאות כדי למנוע קריסה.



![alt text](<שלב ד/image-52.png>)

![alt text](<שלב ד/image-53.png>)



עדכון טבלת operation_report:

![alt text](<שלב ד/operation_report_מחסור בציוד.png>)
 </div>
